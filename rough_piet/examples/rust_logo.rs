//! This example shows painting a rough circle using common-piet crate and
//! kurbo rough shape generator

use palette::{Pixel, Srgb};
use piet::{Color, RenderContext};
use piet_common::kurbo::Rect;
use piet_common::Device;
use rough_piet::KurboGenerator;
use roughr::core::{FillStyle, OptionsBuilder};

const WIDTH: usize = 500;
const HEIGHT: usize = 500;
/// For now, assume pixel density (dots per inch)
const DPI: f32 = 96.;

/// Feature "png" needed for save_to_file() and it's disabled by default for optional dependencies
/// cargo run --example mondrian --features png
fn main() {
    let mut device = Device::new().unwrap();
    let mut bitmap = device.bitmap_target(WIDTH, HEIGHT, 1.0).unwrap();
    let mut rc = bitmap.render_context();
    let options = OptionsBuilder::default()
        .stroke(Srgb::from_raw(&[114u8, 87u8, 82u8]).into_format())
        // .fill(Srgb::from_raw(&[254u8, 246u8, 201u8]).into_format())
        .fill_weight(DPI * 0.01)
        .build()
        .unwrap();

    let generator = KurboGenerator::new(options);
    let heart_svg_path  = "M 297.696 64.7855 C 297.696 58.944 301.2935 53.5485 307.1345 50.6245 C 312.9755 47.7005 320.171 47.708 326.0125 50.6245 C 331.854 53.541 335.45 58.944 335.45 64.7855 C 335.45 73.811 326.9995 81.1285 316.5755 81.1285 C 306.1515 81.1285 297.696 73.811 297.696 64.7855 M 72.4885 212.776 C 72.4885 203.7475 80.939 196.428 91.366 196.428 C 101.793 196.428 110.2425 203.7475 110.2425 212.776 C 110.2425 221.8045 101.7905 229.1225 91.366 229.1225 C 80.9415 229.1225 72.4885 221.8055 72.4885 212.776 M 522.9065 213.5325 C 522.9065 204.5065 531.3585 197.186 541.7815 197.186 C 552.2045 197.186 560.659 204.5065 560.659 213.5325 C 560.659 222.5585 552.208 229.879 541.7815 229.879 C 531.355 229.879 522.9065 222.5595 522.9065 213.5325 M 127.1125 235.9815 C 135.798 232.6185 139.7105 223.815 135.8665 216.2825 L 127.4905 199.8865 L 160.4405 199.8865 L 160.4405 328.4575 L 93.965 328.4575 C 85.764 303.5035 83.2105 277.414 86.4425 251.6225 Z M 264.9065 239.1425 L 264.9065 201.242 L 343.3495 201.242 C 347.3985 201.242 371.931 205.301 371.931 221.1785 C 371.931 234.3785 353.0775 239.127 337.596 239.127 Z M 157.8015 443.189 C 157.8015 437.351 161.3985 431.9565 167.237 429.035 C 173.0755 426.1135 180.275 426.112 186.1145 429.035 C 191.954 431.958 195.5535 437.351 195.5535 443.189 C 195.5535 452.2185 187.1045 459.5385 176.676 459.5385 C 166.2475 459.5385 157.8015 452.2185 157.8015 443.189 M 437.535 443.948 C 437.535 434.921 445.9865 427.598 456.4135 427.598 C 466.8405 427.598 475.2885 434.921 475.2885 443.948 C 475.2885 452.975 466.8365 460.2935 456.4135 460.2935 C 445.9905 460.2935 437.535 452.976 437.535 443.948 M 443.3695 406.873 C 434.042 405.152 424.913 410.272 422.9265 418.3375 L 413.4565 456.6315 C 351.7945 480.8175 281.022 480.522 219.631 455.8255 L 210.1615 417.528 C 208.178 409.447 199.0475 404.327 189.716 406.0635 L 150.675 413.318 C 143.419 406.8485 136.677 399.96 130.488 392.7085 L 320.443 392.7085 C 322.588 392.7085 324.0175 392.366 324.0175 390.68 L 324.0175 332.4945 C 324.0175 330.773 322.588 330.4635 320.443 330.4635 L 264.866 330.4635 L 264.866 293.581 L 324.95 293.581 C 330.43 293.581 354.267 294.956 361.908 321.323 L 373.1235 364.2905 C 376.6955 373.747 391.245 392.7085 406.7275 392.7085 L 504.784 392.7085 C 498.2005 400.3325 491.006 407.5385 483.247 414.2795 Z M 548.8485 253.238 L 525.5255 288.185 C 523.1455 288.185 522.1515 289.56 522.1515 291.5685 L 522.1515 301.0575 C 522.1515 323.4015 507.623 328.2125 494.879 329.4695 C 482.769 330.673 469.2735 325.0685 467.6475 318.6385 C 460.501 283.7845 448.594 276.358 429.933 263.466 C 453.2985 250.606 477.613 231.6645 477.613 206.2775 C 477.613 178.8805 455.916 161.6245 441.127 153.169 C 420.3835 141.308 397.4205 138.9525 391.2265 138.9525 L 144.403 138.9525 C 178.495 105.9645 224.198 83.6295 274.4325 75.406 L 303.5105 101.8245 C 310.061 107.7915 320.9785 108.015 327.848 102.3035 L 360.402 75.3725 C 427.5165 86.2545 485.7065 122.141 519.5335 173.5015 L 497.26 217.0535 C 493.4175 224.5875 497.33 233.3965 506.0115 236.7555 Z M 604.386 253.927 L 603.6315 247.188 L 626.5775 228.6575 C 631.241 224.879 629.4965 217.314 623.543 215.389 L 594.2235 205.901 L 591.924 199.3715 L 610.182 177.3705 C 613.9135 172.9 610.48 165.7665 604.2305 164.872 L 573.306 160.5245 L 569.5905 154.508 L 582.59 129.8055 C 585.255 124.774 580.3065 118.3435 573.9185 118.548 L 542.556 119.495 L 537.5955 114.2865 L 544.802 87.817 C 546.249 82.438 539.9545 76.9885 533.746 78.2435 L 503.1745 84.481 L 497.141 80.1865 L 498.233 53.025 C 498.4715 47.525 491.047 43.2295 485.2535 45.5185 L 456.748 56.7765 L 449.803 53.5395 L 444.76 26.7645 C 443.769 21.333 435.49 18.3735 430.3295 21.608 L 404.922 37.42 L 397.3795 35.443 L 386.4255 10.058 C 384.201 4.8985 375.4485 3.3885 371.099 7.4085 L 349.702 27.278 L 341.922 26.6235 L 325.409 3.51 C 322.0715 -1.17 313.0985 -1.17 309.7875 3.51 L 293.2725 26.6235 L 285.4875 27.278 L 264.053 7.3735 C 259.6865 3.3515 250.952 4.8455 248.729 10.0195 L 237.7735 35.4105 L 230.2285 37.388 L 204.823 21.5695 C 199.662 18.339 191.406 21.317 190.392 26.728 L 185.3495 53.51 L 178.4055 56.74 L 149.9 45.4815 C 144.104 43.1955 136.661 47.4895 136.9175 52.9895 L 138.011 80.1515 L 131.978 84.4475 L 101.4095 78.207 C 95.197 76.9515 88.9045 82.4 90.351 87.7815 L 97.5575 114.252 L 92.5955 119.459 L 61.235 118.516 C 54.883 118.3435 49.9215 124.7365 52.5605 129.769 L 65.565 154.4745 L 61.831 160.4885 L 30.903 164.8365 C 24.6315 165.697 21.2195 172.864 24.949 177.3335 L 43.213 199.3365 L 40.909 205.866 L 11.5915 215.3545 C 5.637 217.2795 3.8915 224.8595 8.555 228.6255 L 31.501 247.1555 L 30.7455 253.8925 L 4.049 268.1925 C -1.3495 271.081 -1.3495 278.8475 4.049 281.7195 L 30.7455 296.02 L 31.501 302.761 L 8.4945 321.3575 C 3.85 325.137 5.5775 332.698 11.5325 334.623 L 40.8495 344.1155 L 43.1515 350.645 L 24.8915 372.647 C 21.1785 377.1195 24.5935 384.2705 30.8445 385.146 L 61.7535 389.4955 L 65.4825 395.509 L 52.484 420.193 C 49.84 425.2125 54.823 431.6575 61.1555 431.448 L 92.517 430.505 L 97.479 435.73 L 90.273 462.2025 C 88.823 467.5635 95.1155 473.027 101.3285 471.758 L 131.898 465.5185 L 137.931 469.8165 L 136.839 496.974 C 136.6 502.4745 144.025 506.769 149.822 504.4855 L 178.325 493.228 L 185.2705 496.4555 L 190.3145 523.221 C 191.3045 528.6685 199.584 531.6045 204.743 528.407 L 230.152 512.563 L 237.6915 514.554 L 248.649 539.9445 C 250.873 545.1015 259.6265 546.612 263.9745 542.574 L 285.3695 522.7055 L 293.152 523.394 L 309.666 546.507 C 312.9995 551.153 321.931 551.1825 325.2875 546.507 L 341.8005 523.394 L 349.584 522.7055 L 370.9785 542.574 C 375.347 546.612 384.083 545.1015 386.3055 539.9445 L 397.2605 514.554 L 404.8025 512.563 L 430.2105 528.407 C 435.3705 531.626 443.6295 528.6685 444.64 523.221 L 449.684 496.4555 L 456.629 493.228 L 485.1325 504.4855 C 490.928 506.769 498.353 502.4925 498.1135 496.974 L 497.023 469.8165 L 503.0375 465.5185 L 533.604 471.758 C 539.818 473.014 546.109 467.5635 544.6615 462.2025 L 537.455 435.73 L 542.4165 430.505 L 573.779 431.448 C 580.13 431.675 585.094 425.2125 582.454 420.193 L 569.452 395.509 L 573.163 389.4955 L 604.088 385.146 C 610.382 384.2855 613.815 377.1345 610.0425 372.647 L 591.785 350.645 L 594.083 344.1155 L 623.4015 334.623 C 629.3565 332.685 631.103 325.121 626.4375 321.3575 L 603.4945 302.828 L 604.2455 296.088 L 630.9435 281.7875 C 636.341 278.902 636.3645 271.166 630.9435 268.258 Z".into();
    let heart_svg_path_drawing = generator.path::<f32>(heart_svg_path);
    let background_color = Color::from_hex_str("96C0B7").unwrap();

    rc.fill(
        Rect::new(0.0, 0.0, WIDTH as f64, HEIGHT as f64),
        &background_color,
    );
    heart_svg_path_drawing.draw(&mut rc);
    rc.finish().unwrap();
    std::mem::drop(rc);

    bitmap.save_to_file("rust.png").expect("file save error");
}
